name: Fully Automated Shorts System

on:
  workflow_dispatch:  # <-- This adds the manual "Run workflow" button
  schedule:
    - cron: "0 */8 * * *"  # <-- still runs automatically every 8 hours


jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the repo
      - uses: actions/checkout@v3

      # 2️⃣ Install Python and FFmpeg
      - name: Setup system
        run: |
          sudo apt update
          sudo apt install ffmpeg wget git -y
          python3 -m pip install --upgrade pip
          pip install -r requirements.txt

      # 3️⃣ Install Piper for voice
      - name: Install Piper
        run: |
          wget https://github.com/rhasspy/piper/releases/download/v1.2.0/piper_linux_x86_64.tar.gz
          tar -xvf piper_linux_x86_64.tar.gz
          sudo mv piper /usr/local/bin/

      # 4️⃣ Install Whisper for captions
      - name: Install Whisper
        run: |
          git clone https://github.com/ggerganov/whisper.cpp
          cd whisper.cpp && make

      # 5️⃣ Run full automation
      - name: Run Full Automation
        run: |
          python3 bg_image.py
          python3 trends.py
          python3 script.py
          python3 voice.py
          python3 captions.py
          python3 video.py
          python3 metadata.py
