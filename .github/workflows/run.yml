name: Fully Automated Shorts System

on:
  workflow_dispatch:  # Manual run button
  schedule:
    schedule:
  - cron: "0 */4 * * *"


jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout the repo
      - uses: actions/checkout@v3

      # 2️⃣ Setup system: Python, FFmpeg, pip
      - name: Setup system
        run: |
          sudo apt update
          sudo apt install ffmpeg wget git -y
          python3 -m pip install --upgrade pip
          pip install -r requirements.txt

      # 3️⃣ Install Piper for voice
      - name: Install Piper
        run: |
          sudo apt update
          sudo apt install wget tar -y
          wget https://github.com/rhasspy/piper/releases/download/2023.11.14-2/piper_linux_x86_64.tar.gz -O piper.tar.gz
          tar -xvf piper.tar.gz
          sudo mv piper /usr/local/bin/

      # 4️⃣ Install Whisper for captions
      - name: Install Whisper
        run: |
          git clone https://github.com/ggerganov/whisper.cpp
          cd whisper.cpp && make

      # 5️⃣ Run full automation
      - name: Run Full Automation
        run: |
          python3 bg_image.py
          python3 trends.py
          python3 script.py
          python3 voice.py
          python3 captions.py
          python3 video.py
          python3 metadata.py

